angular.module("tm.pagination",[]).directive("tmPagination",[function(){return{restrict:"EA",template:'<div class="page-list"><ul class="pagination" ng-show="conf.totalItems > 0"><li ng-class="{disabled: conf.currentPage == 1}" ng-click="prevIndex()"><span>首页</span></li><li ng-class="{disabled: conf.currentPage == 1}" ng-click="prevPage()"><span>上一页</span></li><li ng-repeat="item in pageList track by $index" ng-class="{active: item == conf.currentPage, separate: item == \'...\'}" ng-click="changeCurrentPage(item)"><span>{{ item }}</span></li><li ng-class="{disabled: conf.currentPage == conf.numberOfPages}" ng-click="nextPage()"><span>下一页</span></li><li ng-class="{disabled: conf.currentPage == conf.numberOfPages}" ng-click="nextBack()"><span>尾页</span></li></ul>',replace:!0,scope:{conf:"="},link:function(e){function n(n,a){e.conf.currentPage=parseInt(e.conf.currentPage)?parseInt(e.conf.currentPage):1,e.conf.totalItems=parseInt(e.conf.totalItems)?parseInt(e.conf.totalItems):0,e.conf.itemsPerPage=parseInt(e.conf.itemsPerPage)?parseInt(e.conf.itemsPerPage):15,e.conf.numberOfPages=Math.ceil(e.conf.totalItems/e.conf.itemsPerPage),e.conf.currentPage<1&&(e.conf.currentPage=1),e.conf.numberOfPages>0&&e.conf.currentPage>e.conf.numberOfPages&&(e.conf.currentPage=e.conf.numberOfPages),e.jumpPageNum=e.conf.currentPage;for(var c,t=e.conf.perPageOptions.length,r=0;t>r;r++)e.conf.perPageOptions[r]==e.conf.itemsPerPage&&(c=!0);if(c||e.conf.perPageOptions.push(e.conf.itemsPerPage),e.conf.perPageOptions.sort(function(e,n){return e-n}),e.pageList=[],e.conf.numberOfPages<=e.conf.pagesLength)for(r=1;r<=e.conf.numberOfPages;r++)e.pageList.push(r);else{var o=(e.conf.pagesLength-1)/2;if(e.conf.currentPage<=o)for(r=1;o+1>=r;r++)e.pageList.push(r);else if(e.conf.currentPage>e.conf.numberOfPages-o){for(r=o+1;r>=1;r--)e.pageList.push(e.conf.numberOfPages-r);e.pageList.push(e.conf.numberOfPages)}else{for(r=Math.ceil(o/2);r>=1;r--)e.pageList.push(e.conf.currentPage-r);for(e.pageList.push(e.conf.currentPage),r=1;o/2>=r;r++)e.pageList.push(e.conf.currentPage+r)}}if(e.conf.onChange&&(a==n||0!=a[0])){if("undefined"!=a.split(" ")[1]&&a.split(" ")[1]==n.split(" ")[1])return;e.conf.onChange()}e.$parent.conf=e.conf}e.changeCurrentPage=function(n){"..."!=n&&(e.conf.currentPage=n)},e.conf.pagesLength=parseInt(e.conf.pagesLength)?parseInt(e.conf.pagesLength):9,e.conf.pagesLength%2===0&&(e.conf.pagesLength=e.conf.pagesLength-1),e.conf.perPageOptions||(e.conf.perPageOptions=[10,15,20,30,50]),e.prevPage=function(){e.conf.currentPage>1&&(e.conf.currentPage-=1)},e.prevIndex=function(){e.conf.currentPage>1&&(e.conf.currentPage=1)},e.nextPage=function(){e.conf.currentPage<e.conf.numberOfPages&&(e.conf.currentPage+=1)},e.nextBack=function(){e.conf.currentPage<e.conf.numberOfPages&&(e.conf.currentPage=e.conf.numberOfPages)},e.jumpToPage=function(){e.jumpPageNum=e.jumpPageNum.replace(/[^0-9]/g,""),""!==e.jumpPageNum&&(e.conf.currentPage=e.jumpPageNum)},e.$watch(function(){e.conf.totalItems||(e.conf.totalItems=0);var n=e.conf.totalItems+" "+e.conf.currentPage+" "+e.conf.itemsPerPage;return n},n)}}}]);